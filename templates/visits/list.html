<!-- templates/visits/list.html -->
{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>–í–∏–∑–∏—Ç—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</h2>
    <a href="{{ url_for('visit_create') }}" class="btn btn-success">
        üìÖ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å
    </a>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

{% if visits %}
<table class="table table-sm table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
            <th>–ü–∞—Ü–∏–µ–Ω—Ç</th>
            <th>–í—Ä–∞—á</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–∏–∞–≥–Ω–æ–∑ / –ñ–∞–ª–æ–±—ã</th>
        </tr>
    </thead>
    <tbody>
        {% for v in visits %}
        <tr>
            <td><strong>{{ v.VisitDateTime[:16] }}</strong></td>
            <td>{{ v.patient.FullName }}</td>
            <td>{{ v.doctor.FullName }}<br><small class="text-muted">{{ v.doctor.Specialization }}</small></td>
            <td>
                <span class="badge bg-{{
                    'success' if v.Status == 'completed' else
                    'warning' if v.Status == 'scheduled' else
                    'danger'
                }} text-dark">
                    {{ v.Status }}
                </span>
            </td>
            <td>
                {% if v.Diagnosis %}<strong>–î–∏–∞–≥–Ω–æ–∑:</strong> {{ v.Diagnosis|truncate(40) }}<br>{% endif %}
                {% if v.Complaint %}<small><em>–ñ–∞–ª–æ–±—ã:</em> {{ v.Complaint|truncate(40) }}</small>{% endif %}
                {% if not v.Diagnosis and not v.Complaint %}‚Äî{% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-info">
    <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –í–∏–∑–∏—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ó–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞!
</div>
{% endif %}
{% endblock %}